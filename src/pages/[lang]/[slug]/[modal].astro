---
import type { AstroComponentFactory } from 'astro/runtime/server/index.js';
import { getLangFromUrl, useTranslations } from '@i18n/utils';
import ModalDialog from '@components/modalDialog/ModalDialog.astro';
import ShareContent from '@components/share/Share.astro';
import ContactContent from '@components/contact/Contact.astro';
import IconContact from '@assets/menuIcons/contact.png';
import IconShare from '@assets/menuIcons/share.png';
import type { SlugWithModalTypes, ModalSlugPath } from '@i18n/routes';
import type { DanishLanguageSlug } from '@i18n/settings';
import ContactConfirmation from '@components/contact/Confirmation.astro';
import ContactError from '@components/contact/Error.astro';
import About from '@layouts/About.astro';
import Skills from '@layouts/Skills.astro';
import Work from '@layouts/work/Work.astro';
import Archive from '@layouts/Archive.astro';

type DanishModalSlugPaths = {
  [P in SlugWithModalTypes<'da'>]: {
    params: { lang: DanishLanguageSlug } & ModalSlugPath<P>;
  };
};

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang, 'navigation');

export function getStaticPaths() {
  // Helper function to create a type-safe path object
  const createPaths = <T extends DanishModalSlugPaths>(paths: T): T => paths;
  const paths = createPaths({
    ['arbejde/del']: { params: { lang: 'da', slug: 'arbejde', modal: 'del' } },
    ['arbejde/kontakt']: {
      params: { lang: 'da', slug: 'arbejde', modal: 'kontakt' },
    },
    ['arbejde/besked-modtaget']: {
      params: { lang: 'da', slug: 'arbejde', modal: 'besked-modtaget' },
    },
    ['arbejde/besked-fejl']: {
      params: { lang: 'da', slug: 'arbejde', modal: 'besked-fejl' },
    },
    ['kompetencer/del']: {
      params: { lang: 'da', slug: 'kompetencer', modal: 'del' },
    },
    ['kompetencer/kontakt']: {
      params: { lang: 'da', slug: 'kompetencer', modal: 'kontakt' },
    },
    ['kompetencer/besked-modtaget']: {
      params: { lang: 'da', slug: 'kompetencer', modal: 'besked-modtaget' },
    },
    ['kompetencer/besked-fejl']: {
      params: { lang: 'da', slug: 'kompetencer', modal: 'besked-fejl' },
    },
    ['om-mig/del']: { params: { lang: 'da', slug: 'om-mig', modal: 'del' } },
    ['om-mig/kontakt']: {
      params: { lang: 'da', slug: 'om-mig', modal: 'kontakt' },
    },
    ['om-mig/besked-modtaget']: {
      params: { lang: 'da', slug: 'om-mig', modal: 'besked-modtaget' },
    },
    ['om-mig/besked-fejl']: {
      params: { lang: 'da', slug: 'om-mig', modal: 'besked-fejl' },
    },
    ['arkiv/del']: { params: { lang: 'da', slug: 'arkiv', modal: 'del' } },
    ['arkiv/kontakt']: {
      params: { lang: 'da', slug: 'arkiv', modal: 'kontakt' },
    },
    ['arkiv/besked-modtaget']: {
      params: { lang: 'da', slug: 'arkiv', modal: 'besked-modtaget' },
    },
    ['arkiv/besked-fejl']: {
      params: { lang: 'da', slug: 'arkiv', modal: 'besked-fejl' },
    },
  });
  return Object.values(paths);
}

const { slug, modal } = Astro.params;

const danishModalSlugMap: Record<
  SlugWithModalTypes<'da'>,
  {
    pageComponent: AstroComponentFactory;
    modalComponent: AstroComponentFactory;
    modalIcon: ImageMetadata;
    pageTitle: string;
    modalTitle: string;
  }
> = {
  ['arbejde/del']: {
    pageComponent: Work,
    modalComponent: ShareContent,
    modalIcon: IconShare,
    pageTitle: t('work'),
    modalTitle: t('share'),
  },
  ['arbejde/kontakt']: {
    pageComponent: Work,
    modalComponent: ContactContent,
    modalIcon: IconContact,
    pageTitle: t('work'),
    modalTitle: t('contact'),
  },
  ['arbejde/besked-modtaget']: {
    pageComponent: Work,
    modalComponent: ContactConfirmation,
    modalIcon: IconContact,
    pageTitle: t('work'),
    modalTitle: t('thank_you'),
  },
  ['arbejde/besked-fejl']: {
    pageComponent: Work,
    modalComponent: ContactError,
    modalIcon: IconContact,
    pageTitle: t('work'),
    modalTitle: t('whoops'),
  },
  ['kompetencer/del']: {
    pageComponent: Skills,
    modalComponent: ShareContent,
    modalIcon: IconShare,
    pageTitle: t('work'),
    modalTitle: t('share'),
  },
  ['kompetencer/kontakt']: {
    pageComponent: Skills,
    modalComponent: ContactContent,
    modalIcon: IconContact,
    pageTitle: t('work'),
    modalTitle: t('contact'),
  },
  ['kompetencer/besked-modtaget']: {
    pageComponent: Skills,
    modalComponent: ContactConfirmation,
    modalIcon: IconContact,
    pageTitle: t('work'),
    modalTitle: t('thank_you'),
  },
  ['kompetencer/besked-fejl']: {
    pageComponent: Skills,
    modalComponent: ContactError,
    modalIcon: IconContact,
    pageTitle: t('work'),
    modalTitle: t('whoops'),
  },
  ['om-mig/del']: {
    pageComponent: About,
    modalComponent: ShareContent,
    modalIcon: IconShare,
    pageTitle: t('about'),
    modalTitle: t('share'),
  },
  ['om-mig/kontakt']: {
    pageComponent: About,
    modalComponent: ContactContent,
    modalIcon: IconContact,
    pageTitle: t('about'),
    modalTitle: t('contact'),
  },
  ['om-mig/besked-modtaget']: {
    pageComponent: About,
    modalComponent: ContactConfirmation,
    modalIcon: IconContact,
    pageTitle: t('about'),
    modalTitle: t('thank_you'),
  },
  ['om-mig/besked-fejl']: {
    pageComponent: About,
    modalComponent: ContactError,
    modalIcon: IconContact,
    pageTitle: t('about'),
    modalTitle: t('whoops'),
  },
  ['arkiv/del']: {
    pageComponent: Archive,
    modalComponent: ShareContent,
    modalIcon: IconShare,
    pageTitle: t('archive'),
    modalTitle: t('share'),
  },
  ['arkiv/kontakt']: {
    pageComponent: Archive,
    modalComponent: ContactContent,
    modalIcon: IconContact,
    pageTitle: t('archive'),
    modalTitle: t('contact'),
  },
  ['arkiv/besked-modtaget']: {
    pageComponent: Archive,
    modalComponent: ContactConfirmation,
    modalIcon: IconContact,
    pageTitle: t('archive'),
    modalTitle: t('thank_you'),
  },
  ['arkiv/besked-fejl']: {
    pageComponent: Archive,
    modalComponent: ContactError,
    modalIcon: IconContact,
    pageTitle: t('archive'),
    modalTitle: t('whoops'),
  },
};

const ModalContent = danishModalSlugMap[`${slug}/${modal}`]?.modalComponent;

const PageContent = danishModalSlugMap[`${slug}/${modal}`]?.pageComponent;

const iconImage = danishModalSlugMap[`${slug}/${modal}`]?.modalIcon;

const modalTitle = danishModalSlugMap[`${slug}/${modal}`]?.modalTitle;
const pageTitle = danishModalSlugMap[`${slug}/${modal}`]?.pageTitle;
---

<PageContent title={pageTitle} inert={true}>
  <ModalDialog
    title={modalTitle}
    labels={{ close: t('close_modal_title') }}
    iconImage={iconImage}
    gradientColor="verdigris"
    ><ModalContent />
  </ModalDialog>
</PageContent>
