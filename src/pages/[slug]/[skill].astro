---
import { getLangFromUrl } from '@i18n/utils';
import SkillsLayout from '@layouts/Skills.astro';
import type { SlugWithSkillTypes, SkillSlugPath } from '@i18n/routes';
import {
  skillsObject,
  techSkillEntries,
  type TechSkill,
} from '@content/techSkills';
const skillIconImages = import.meta.glob('@assets/skillIcons/*.svg', {
  query: '?raw',
  import: 'default',
});

type EnglishSkillSlugPaths = {
  [P in SlugWithSkillTypes<'en'>]: {
    params: SkillSlugPath<P>;
  };
};

const lang = getLangFromUrl(Astro.url);

export function getStaticPaths() {
  // Helper function to create a type-safe path object
  const createPaths = (skills: readonly TechSkill[]): EnglishSkillSlugPaths => {
    return skills.reduce<EnglishSkillSlugPaths>(
      (acc, skill) => ({
        ...acc,
        [`skills/${skill}`]: { params: { slug: 'skills', skill } },
      }),
      {} as EnglishSkillSlugPaths
    );
  };

  const paths = createPaths(techSkillEntries);
  return Object.values(paths);
}

const { skill } = Astro.params;

const skillData = skillsObject[lang][skill];

const svgPath = Object.entries(skillIconImages).find(([path]) =>
  path.includes(skillData.imageSrc)
);

if (!svgPath) {
  console.error(`Skill image not found for: ${skillData.imageSrc}`);
  return null;
}
const svgContent = (await svgPath[1]()) as string;
const techSkill = { ...skillData, svgContent };

const pageTitle = skillData.title;
---

<SkillsLayout title={pageTitle} inert={false} techSkill={techSkill} />
