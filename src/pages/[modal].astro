---
import HomeLayout from '@layouts/Home.astro';
import type { AstroComponentFactory } from 'astro/runtime/server/index.js';
import { getLangFromUrl, useTranslations } from '../i18n/utils';
import ModalDialog from '@components/modalDialog/ModalDialog.astro';
import ShareContent from '@components/share/Share.astro';
import ContactContent from '@components/contact/Contact.astro';
import IconContact from '@assets/menuIcons/contact.png';
import IconShare from '@assets/menuIcons/share.png';
import type { EnglishModalTypes } from '@i18n/routes';

type EnglishModalPath = { params: { modal: EnglishModalTypes } };

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang, 'navigation');

export function getStaticPaths() {
  const paths: EnglishModalPath[] = [
    { params: { modal: 'share' } },
    { params: { modal: 'contact' } },
  ];
  return paths;
}

const { modal } = Astro.params;

const modalMap: Record<
  string,
  { component: AstroComponentFactory; icon: ImageMetadata; title: string }
> = {
  share: { component: ShareContent, icon: IconShare, title: t('share') },
  contact: {
    component: ContactContent,
    icon: IconContact,
    title: t('contact_title'),
  },
};

const ModalContent: AstroComponentFactory | undefined =
  modalMap[modal]?.component;

const iconImage = modalMap[modal]?.icon;

const modalTitle = modalMap[modal]?.title;

// Throw an error during the static build if the modal is undefined
if (!ModalContent) {
  throw new Error(`Modal type "${modal}" not found.`);
}

// Throw an error during the static build if the icon is undefined
if (!iconImage) {
  throw new Error(`IconImage not found in modal for "${iconImage}".`);
}

// Throw an error during the static build if the title is undefined
if (!modalTitle) {
  throw new Error(`modalTitle not found in modal for "${modalTitle}".`);
}
---

<HomeLayout title={modalTitle} lang={lang} inert
  ><ModalDialog
    title={modalTitle}
    labels={{ close: t('close_modal_title') }}
    iconImage={iconImage}
    ><ModalContent />
  </ModalDialog>
</HomeLayout>
