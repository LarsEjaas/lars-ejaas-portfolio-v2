---
import HomeLayout from '@layouts/Home.astro';
import type { AstroComponentFactory } from 'astro/runtime/server/index.js';
import { getLangFromUrl, useTranslations } from '@i18n/utils';
import ModalDialog from '@components/modalDialog/ModalDialog.astro';
import ShareContent from '@components/share/Share.astro';
import ContactContent from '@components/contact/Contact.astro';
import ContactConfirmation from '@components/contact/Confirmation.astro';
import ContactError from '@components/contact/Error.astro';
import IconContact from '@assets/menuIcons/contact.png';
import IconShare from '@assets/menuIcons/share.png';
import type { ModalTypes } from '@i18n/routes';

type EnglishModalPaths = {
  [K in ModalTypes<'en'>]: { params: { modal: K } };
};

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang, 'navigation');

export function getStaticPaths() {
  // Helper function to create a type-safe path object
  const createPaths = <T extends EnglishModalPaths>(paths: T): T => paths;
  const paths = createPaths({
    share: { params: { modal: 'share' } },
    contact: { params: { modal: 'contact' } },
    ['message-received']: { params: { modal: 'message-received' } },
    ['message-error']: { params: { modal: 'message-error' } },
  });
  return Object.values(paths);
}

const { modal } = Astro.params;

const modalMap: Record<
  ModalTypes<'en'>,
  { component: AstroComponentFactory; icon: ImageMetadata; title: string }
> = {
  share: { component: ShareContent, icon: IconShare, title: t('share') },
  contact: {
    component: ContactContent,
    icon: IconContact,
    title: t('contact_title'),
  },
  ['message-received']: {
    component: ContactConfirmation,
    icon: IconContact,
    title: t('thank_you'),
  },
  ['message-error']: {
    component: ContactError,
    icon: IconContact,
    title: t('whoops'),
  },
};

const ModalContent: AstroComponentFactory | undefined =
  modalMap[modal]?.component;

const iconImage = modalMap[modal]?.icon;

const modalTitle = modalMap[modal]?.title;

const gradientColor = 'verdigris';

// Throw an error during the static build if the modal is undefined
if (!ModalContent) {
  throw new Error(`Modal type "${modal}" not found.`);
}

// Throw an error during the static build if the icon is undefined
if (!iconImage) {
  throw new Error(`IconImage not found in modal for "${iconImage}".`);
}

// Throw an error during the static build if the title is undefined
if (!modalTitle) {
  throw new Error(`modalTitle not found in modal for "${modalTitle}".`);
}
---

<HomeLayout title={modalTitle} lang={lang} inert
  ><ModalDialog
    title={modalTitle}
    labels={{ close: t('close_modal_title') }}
    iconImage={iconImage}
    gradientColor={gradientColor}
    ><ModalContent />
  </ModalDialog>
</HomeLayout>
