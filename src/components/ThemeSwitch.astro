---
import './themeSwitch.css';
type Props = Record<string, never>;
---

<script>
  import { setValueInLocalStorage, DARKMODE_KEY } from '@utils/localStorage';
  const rootElement = document.documentElement;
  const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');

  /**
   * Toggles the theme between light and dark mode.
   */
  const toggleTheme = (_event: MouseEvent) => {
    const isDarkMode = rootElement.dataset.darkMode === 'true';
    setValueInLocalStorage(DARKMODE_KEY, !isDarkMode);
    rootElement.dataset.darkMode = isDarkMode ? 'false' : 'true';
  };

  /**
   * Handles changes to the user's preferred color scheme.
   */
  function handleColorSchemeChange(event: MediaQueryListEvent) {
    if (event.matches) {
      // Dark mode is preferred
      rootElement.dataset.darkMode = 'true';
    } else {
      // Light mode is preferred
      rootElement.dataset.darkMode = 'false';
    }
  }

  darkModeMediaQuery.addEventListener('change', handleColorSchemeChange);

  if (window.themeToggle instanceof HTMLInputElement) {
    window.themeToggle.addEventListener('click', toggleTheme);
    /*set initial toggle state based on the current system theme*/
    if (rootElement.dataset.darkMode === 'true') {
      window.themeToggle.checked = true;
    } else {
      window.themeToggle.checked = false;
    }
  }
</script>
<div class="theme-switch-wrapper">
  <div
    id="themeSwitch"
    aria-label="Switch to dark mode"
    title="Switch to dark mode"
  >
    <input aria-labelledby="themeSwitch" type="checkbox" id="themeToggle" />
    <span></span>
  </div>
</div>
