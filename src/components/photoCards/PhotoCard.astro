---
import styles from './photoCard.module.css';
import { Picture } from 'astro:assets';
import { aboutImagesInfo } from '@content/aboutImages/aboutImages';
import { getLangFromUrl } from '@i18n/utils';
import { useTranslatedPath } from '@i18n/utils';

const CARD_ROTATIONS = [-4, 6, -2, 3, -5, 2, -4, 3, -4, 2, -5, 4, -3, 2, -4, 5];

type Props = {
  ImageComponent: ImageMetadata & { placeholder?: string };
  imageName: string;
  index: number;
  includeViewTransitionId: boolean;
  /** Can be used to rotate all the images in the opposite direction */
  reverseRotation?: boolean;
};

const language = getLangFromUrl(Astro.url);

const {
  ImageComponent,
  imageName,
  reverseRotation,
  index,
  includeViewTransitionId,
} = Astro.props;

const imageInfo = aboutImagesInfo.find((info) => info.imageName === imageName);

if (!imageInfo) {
  throw new Error(`No aboutImagesInfo found for the name: ${imageName}`);
}

const imageAlt =
  imageInfo[`imageAlt${language.toUpperCase()}` as keyof typeof imageInfo];
const englishUrl = `about/${imageInfo.hrefEN}`;
const lang = getLangFromUrl(Astro.url);
const translatePath = useTranslatedPath(lang);
---

<a
  href={translatePath(englishUrl)}
  id={includeViewTransitionId ? imageInfo.id : undefined}
  data-reverse-rotate={reverseRotation || undefined}
  style={`--index: ${index}; --rotation: ${CARD_ROTATIONS[index]}deg;`}
>
  <div
    class={styles.photocard}
    style={includeViewTransitionId
      ? `view-transition-name: ${imageInfo.id};`
      : undefined}
  >
    <Picture
      formats={['avif', 'webp']}
      quality="high"
      src={ImageComponent}
      alt={imageAlt}
      width={ImageComponent.width}
      height={ImageComponent.height}
      widths={[260, 320, 440, 520]}
      sizes="(max-width: 480px) 260px, (max-width: 768px) 320px, (max-width: 1024px) 440px, 520px"
      loading="eager"
      decoding="sync"
      pictureAttributes={{
        style: {
          aspectRatio: `${ImageComponent.width / ImageComponent.height}`,
          ...(ImageComponent.placeholder
            ? { backgroundImage: `url(${ImageComponent.placeholder});` }
            : {}),
        },
      }}
    />
  </div>
</a>
