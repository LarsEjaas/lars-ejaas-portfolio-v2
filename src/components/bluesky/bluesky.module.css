:import('@components/modalDialog/modalDialog.module.css') {
  scrollfade: scrollfade;
}

.card {
  max-width: 778px;
}

.cardContent {
  --article-height: 436px;
  overflow-y: hidden;
  position: relative;
  display: flex;
  flex-direction: column;
  padding-block: 68px 20px;
  border-radius: var(--border-radius-md);
  container-type: inline-size;
  container-name: blueskyFeedCard;
  @supports (animation-timeline: scroll()) {
    timeline-scope: --one, --two, --three, --four, --five, --six;
  }
}

.skipLink {
  position: absolute;
  top: 0.5rem;
  left: 0.5rem;
  background: light-dark(var(--system-shadow-7), var(--system-light-400));
  color: var(--system-dark-200);
  padding: 0.5rem;
  z-index: 100;
  transform: translateY(-150%);
  transition: transform 0.2s ease;
  outline-offset: var(--outline-offset);
  &:focus-visible {
    transform: unset;
  }
  &:visited {
    color: var(--system-dark-200);
  }
}

.feedList {
  padding: 0;
  scrollbar-width: none;
  inline-size: 100%;
  scroll-behavior: smooth;
  display: grid;
  grid-auto-flow: column;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  overscroll-behavior-x: contain;
  scroll-snap-align: start;
  border-bottom-left-radius: var(--border-radius-md);
  border-bottom-right-radius: var(--border-radius-md);
  --mask-margin-left: 2.75rem;
  --mask-padding-left: 2rem;
  --mask-padding-right: 2rem;
  --bottom-mask-height: calc(100% - var(--article-height));
  mask:
    linear-gradient(
      90deg,
      transparent,
      transparent var(--mask-margin-left),
      white calc(var(--mask-margin-left) + var(--mask-padding-left)),
      white calc(100% - var(--mask-padding-right)),
      transparent
    ),
    linear-gradient(
      90deg,
      transparent,
      white var(--mask-padding-left),
      white calc(100% - var(--mask-padding-right)),
      transparent
    );
  mask-size:
    100% var(--article-height),
    100% var(--bottom-mask-height);
  mask-position: top, bottom;
  mask-repeat: no-repeat, no-repeat;
  mask-composite: add;
}

.thread {
  list-style-type: none;
  scroll-snap-align: start;
  display: block;
  position: relative;
  z-index: -1;
  @supports (animation-timeline: view()) {
    &:nth-of-type(1) {
      view-timeline: --one inline;
    }
    &:nth-of-type(2) {
      view-timeline: --two inline;
    }
    &:nth-of-type(3) {
      view-timeline: --three inline;
    }
    &:nth-of-type(4) {
      view-timeline: --four inline;
    }
    &:nth-of-type(5) {
      view-timeline: --five inline;
    }
    &:nth-of-type(6) {
      view-timeline: --six inline;
    }
  }
}
.article {
  padding-inline: 1rem;
  width: 100cqi;
  display: flex;
  flex-direction: column;
}

.threadWrapper {
  display: grid;
  grid-template-columns: 48px 1fr;
  height: var(--article-height);
}

.profileTimeline {
  position: absolute;
  top: auto;
  left: 1rem;
  z-index: 10;
  height: var(--article-height);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 3px;
  color: light-dark(var(--system-shadow-7), var(--system-light-400));
}

.postWrapper {
  grid-column: 2;
  display: flex;
  flex-direction: column;
  gap: 8px;
  height: var(--article-height);
}

.threadContent {
  flex: 1 0 auto;
  height: calc(100% - 46px);
  overflow-y: auto;
  &[data-no-scroll] {
    overflow-y: hidden;
  }
  padding-inline: 8px;
  padding-bottom: 4px;
  @container blueskyFeedCard (width >= 430px) {
    height: calc(100% - 29px);
  }
  /** Scroll-shadows */
  @supports (animation-timeline: view()) {
    mask: linear-gradient(
      to bottom,
      #0000,
      #ffff var(--top-fade) calc(100% - var(--bottom-fade)),
      #0000
    );
    animation: scrollfade;
    animation-timeline: --scrollfade;
    scroll-timeline: --scrollfade y;
  }
}

.postContent {
  white-space: pre-line;
  font-size: var(--font-size-2);
  line-height: 1.5;
  color: light-dark(var(--system-dark-200), var(--system-dark-100));
  margin-block-end: 0;
  font-weight: 400;
}

:global(:root[data-dark-mode='true']) .postContent {
  font-weight: 300;
}

.postLink {
  composes: link from '@components/externalLink/externalLink.module.css';
  color: light-dark(var(--system-dark-200), var(--system-dark-100));
  font-size: var(--font-size-2);
  max-width: 28ch;
  display: inline-block;
  vertical-align: bottom;
  overflow: hidden;
  text-overflow: ellipsis;
}

.postHashtag {
  font-weight: 600;
}

.divider {
  width: 100%;
  height: 1px;
  background-color: light-dark(var(--system-shadow-7), var(--system-light-400));
  margin-block: 8px;
}

.threadFooter {
  display: flex;
  flex-direction: row;
  padding-right: 1rem;
  align-items: center;
  justify-content: space-between;
  column-gap: 8px;
  flex-wrap: wrap;
  padding-block: 8px;
}

.viewOnBluesky {
  border: unset;
  background-color: light-dark(
    var(--system-light-400),
    color-mix(in hsl, var(--system-dark-200-16), transparent 50%)
  );
  width: fit-content;
  padding: 6px 12px;
  display: flex;
  align-items: center;
  gap: 4px;
  cursor: pointer;
  outline-offset: var(--outline-offset);
  color: light-dark(var(--system-dark-200), var(--system-dark-100));
  font-size: var(--font-size-2);
  font-weight: 500;
  border-radius: var(--border-radius-md);
  margin-left: auto;
  margin-block: 4px;
  text-decoration-color: transparent;
  transition:
    text-decoration-color 300ms,
    background-color 300ms;
  &:hover,
  &:focus-visible {
    background-color: light-dark(
      var(--system-light-500),
      color-mix(in hsl, var(--system-dark-200-16), transparent 25%)
    );
    text-decoration-color: currentColor;
    transition:
      text-decoration-color 300ms,
      background-color 300ms;
  }
  & p {
    margin-top: 2px;
    text-wrap: nowrap;
    white-space-collapse: collapse;
  }
  & svg {
    flex-shrink: 0;
  }
}

.profileInfo {
  display: flex;
  flex-direction: column;
  row-gap: 4px;
  padding-inline: 8px;
  line-height: 1;
  @container blueskyFeedCard (width >= 430px) {
    flex-direction: row;
    align-items: center;
    column-gap: 8px;
  }
}

.displayName {
  margin-block-end: 0;
  margin-top: 1px;
  font-size: var(--font-size-3);
  color: light-dark(var(--system-dark-100), var(--system-dark-300));
}

.postDate {
  margin-top: 3px;
  font-size: var(--font-size-2);
  color: var(--system-dark-300-80);
  font-weight: 600;
}

.blueSkyIcon {
  position: absolute;
  top: -12px;
  right: -12px;
  z-index: 1;
  width: 96px;
}

.timelineDivider {
  flex: 1 0 auto;
  width: 2px;
  background-color: currentColor;
}

.butterfly {
  position: absolute;
  top: -22px;
  left: -15px;
  background-color: var(--system-dark-300-55);
  mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="122" height="107" viewBox="0 0 122 107"><path d="M60.9002 50.0081C66.209 38.6319 81.3772 17.3965 95.4078 7.15799C105.267 -0.42609 121.573 -6.11415 121.573 12.4669C121.573 16.2589 119.298 43.5616 118.16 48.112C113.989 63.6594 98.0622 67.4515 84.0316 65.1762C108.68 69.3475 114.747 83.378 101.475 97.0294C75.6891 123.194 64.6922 90.5829 61.6586 81.8612L61.5448 81.5199C61.2036 80.3823 61.1656 80.0031 60.7864 80.0031C60.4072 80.0031 60.4451 80.7615 60.028 81.5199L59.9142 81.8612C56.8806 90.2037 45.8837 123.194 20.0978 97.0294C6.44647 83.378 12.8929 69.3475 37.5412 65.1762C23.5107 67.4515 7.58408 63.6594 3.41284 48.112C2.27523 43.5616 0 16.2589 0 12.4669C0 -6.11415 16.3058 -0.42609 26.1651 7.15799C40.1956 17.7757 54.9846 38.6319 60.6727 50.0081H60.9002Z" fill-opacity="0.16"/></svg>');
  mask-size: contain;
  mask-repeat: no-repeat;
  width: 122px;
  height: 107px;
}

.butterflyPlaceholder {
  height: 100%;
  aspect-ratio: 1;
  clip-path: url(#squircle);
}

.pagination {
  display: flex;
  width: 100cqi;
  justify-content: center;
}

.controls {
  display: flex;
  justify-content: center;
  padding: 0;
  --control-padding: 5px;
  --control-height: 26px;
  @media (max-width: 769px) {
    --control-height: 36px;
  }
  height: var(--control-height);
  list-style-type: none;
  aspect-ratio: calc(var(--slide-length) / 1);
  @supports (animation-timeline: view()) {
    aspect-ratio: calc(var(--slide-length) + 0.6 / 1);
  }
}

@keyframes expandControls {
  50% {
    flex: 3;
  }
}

.control {
  display: block;
  height: fit-content;
  flex: 1;
  border: var(--control-padding) solid transparent;
  transition: width 0.3s ease-in-out;
  @supports (animation-timeline: view()) {
    &:nth-of-type(1) {
      animation-timeline: --one;
    }
    &:nth-of-type(2) {
      animation-timeline: --two;
    }
    &:nth-of-type(3) {
      animation-timeline: --three;
    }
    &:nth-of-type(4) {
      animation-timeline: --four;
    }
    &:nth-of-type(5) {
      animation-timeline: --five;
    }
    &:nth-of-type(6) {
      animation-timeline: --six;
    }
    scroll-timeline-axis: inline;
    animation: expandControls;
    animation-fill-mode: both;
    animation-timing-function: linear;
  }
  & a {
    height: calc(var(--control-height) - 2 * var(--control-padding));
    min-width: calc(var(--control-height) - 2 * var(--control-padding));
    display: block;
    outline-offset: var(--outline-offset);
    background-color: light-dark(
      var(--system-dark-300-55),
      var(--system-light-400)
    );
    border-radius: var(--border-radius-lg);
  }
}

.profileWrapper {
  line-height: 0;
  position: relative;
}

.profileButton {
  cursor: pointer;
  border: unset;
  background: unset;
  border-radius: 50%;
  padding: 0;
  overflow: hidden;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  overflow: hidden;
  position: relative;
  outline-offset: var(--outline-offset);
}

.image {
  width: 48px;
  height: 48px;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

.profilePlaceholder {
  width: 100%;
  aspect-ratio: 1/1;
  z-index: -1;
}

.profileImage {
  border-radius: 50%;
}
