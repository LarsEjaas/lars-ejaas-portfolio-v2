---
import styles from './headerMenu.module.css';
import {
  getLangFromUrl,
  removeTrailingSlash,
  useTranslatedPath,
  useTranslations,
} from '@i18n/utils';
import { Picture } from 'astro:assets';
import IconWork from '@assets/menuIcons/work.png';
import IconSkills from '@assets/menuIcons/skillset.png';
import IconAbout from '@assets/menuIcons/about.png';
import IconContact from '@assets/menuIcons/contact.png';
import IconShare from '@assets/menuIcons/share.png';
import LanguageToggle from '@components/languageToggle/LanguageToggle.astro';
import ThemeSwitch from '@components/themeSwitch/ThemeSwitch.astro';
import ejaasLogo from './ejaasLogo.svg';
import { appRoutes } from '@i18n/routes';
import { menuIconPlaceholders } from '@utils/misc';

type Props = {
  inert: boolean;
  withDarkkModeToggle?: boolean;
  withModalLinks?: boolean;
};
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang, 'navigation');
const translatePath = useTranslatedPath(lang);
const {
  inert,
  withDarkkModeToggle = true,
  withModalLinks = true,
} = Astro.props;
const shareUrl = `${removeTrailingSlash(Astro.url.pathname)}/${appRoutes[lang].share}/`;
const contactUrl = `${removeTrailingSlash(Astro.url.pathname)}/${appRoutes[lang].contact}/`;
---

<script>
  import { initializeKeyboardArrowNavigation } from '@utils/keyboardArrowNavigation';
  import { storeScrollPositionOnClick } from '@utils/scrollPosition';

  if (window.desktopMenuContainer) {
    initializeKeyboardArrowNavigation(window.desktopMenuContainer);
  }
  if (window.desktopShareLink) {
    storeScrollPositionOnClick(window.desktopShareLink);
  }
  if (window.desktopContactLink) {
    storeScrollPositionOnClick(window.desktopContactLink);
  }
</script>
<header class={styles.header} inert={inert}>
  <div
    id="desktopMenuContainer"
    role="group"
    aria-keyshortcuts="ArrowLeft ArrowRight"
    class={`${styles.desktopMenu} desktop-only`}
  >
    <nav
      aria-labelledby="desktopMenuTitle"
      role="listbox"
      aria-label={t('nav_desktop')}
    >
      <h2 class="sr-only" id="desktopMenuTitle">
        {t('nav_desktop')}
      </h2>
      <a
        data-arrow-nav="true"
        title={t('home')}
        role="option"
        href={translatePath('/')}
        class={styles.homeLink}
      >
        <p id="lightboxTitle" class="sr-only">{t('home')}</p>
        <div
          class={styles.ejaasLogo}
          style={{
            backgroundImage: `url(${ejaasLogo.src})`,
            width: `${ejaasLogo.width}px`,
            aspectRatio: `${ejaasLogo.width / ejaasLogo.height}`,
          }}
        >
        </div>
      </a>
      <a
        data-arrow-nav="true"
        role="option"
        href={translatePath('/work/')}
        class={styles.workLink}
        ><div class="squircle" data-with-shadow="true">
          <div
            class="placeholder"
            style={{
              'background-image': `url('${menuIconPlaceholders.work}')`,
            }}
          >
          </div>
          {
            /* Render images slightly too large to avoid dublicating for mobile menu */
          }
          <Picture
            aria-hidden="true"
            formats={['avif', 'webp']}
            quality="high"
            src={IconWork}
            alt=""
            width="40"
            height="40"
            widths={[48, 96, 144]}
            loading="eager"
            decoding="sync"
          />
        </div>
        <p>{t('work')}</p>
      </a>
      <a
        data-arrow-nav="true"
        role="option"
        href={translatePath('/skills/')}
        class={styles.skillsLink}
        ><div class="squircle" data-with-shadow="true">
          <div
            class="placeholder"
            style={{
              'background-image': `url('${menuIconPlaceholders.skills}')`,
            }}
          >
          </div>
          {
            /* Render images slightly too large to avoid dublicating for mobile menu */
          }
          <Picture
            aria-hidden="true"
            formats={['avif', 'webp']}
            quality="high"
            src={IconSkills}
            alt=""
            width="40"
            height="40"
            widths={[48, 96, 144]}
            loading="eager"
            decoding="sync"
          />
        </div><p>{t('skills')}</p></a
      >
      <a
        data-arrow-nav="true"
        role="option"
        href={translatePath('/about/')}
        class={styles.aboutLink}
        ><div class="squircle" data-with-shadow="true">
          <div
            class="placeholder"
            style={{
              'background-image': `url('${menuIconPlaceholders.about}')`,
            }}
          >
          </div>
          {
            /* Render images slightly too large to avoid dublicating for mobile menu */
          }
          <Picture
            aria-hidden="true"
            formats={['avif', 'webp']}
            quality="high"
            src={IconAbout}
            alt=""
            width="48"
            height="48"
            widths={[48, 96, 144]}
            loading="eager"
            decoding="sync"
          />
        </div><p>{t('about')}</p></a
      >
      {
        withModalLinks && (
          <div class={styles.navSection}>
            <a
              data-arrow-nav="true"
              role="option"
              href={contactUrl}
              title={t('contact')}
              aria-label={t('contact')}
              id="desktopContactLink"
            >
              <div class="squircle" data-with-shadow="true">
                <div
                  class="placeholder"
                  style={{
                    'background-image': `url('${menuIconPlaceholders.contact}')`,
                  }}
                />
                {/* Render images slightly too large to avoid dublicating for mobile menu */}
                <Picture
                  aria-hidden="true"
                  formats={['avif', 'webp']}
                  quality="high"
                  src={IconContact}
                  alt=""
                  width="48"
                  height="48"
                  widths={[48, 96, 144]}
                  loading="eager"
                  decoding="sync"
                />
              </div>
            </a>
            <a
              data-arrow-nav="true"
              role="option"
              href={shareUrl}
              title={t('share')}
              aria-label={t('share')}
              id="desktopShareLink"
            >
              <div class="squircle" data-with-shadow="true">
                <div
                  class="placeholder"
                  style={{
                    'background-image': `url('${menuIconPlaceholders.share}')`,
                  }}
                />
                {/* Render images slightly too large to avoid dublicating for mobile menu */}
                <Picture
                  aria-hidden="true"
                  formats={['avif', 'webp']}
                  quality="high"
                  src={IconShare}
                  alt=""
                  width="48"
                  height="48"
                  widths={[48, 96, 144]}
                  loading="eager"
                  decoding="sync"
                />
              </div>
            </a>
          </div>
        )
      }
    </nav>
    <div class={styles.actions}>
      <div class={styles.divider}></div>
      <LanguageToggle />
      {withDarkkModeToggle && <ThemeSwitch withGlow={false} isMobile={false} />}
    </div>
  </div>
  <div class={`${styles.mobileActions} mobile-only`}>
    <LanguageToggle withBackground={true} />
    {withDarkkModeToggle && <ThemeSwitch withGlow={true} isMobile={true} />}
  </div>
</header>
